@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
<head>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    @*<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">*@
</head>
<div class="text-center">
    <h1 class="display-4">Covid Data</h1>
    <p>Pick a state below</p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <div class="dropdown-space dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span id="selected">Choose State</span><span class="caret"></span>
        </button>
        <div class="dropdown-menu pre-scrollable" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#">Choose State</a>
            <a class="dropdown-item" href="#">Alabama</a>
            <a class="dropdown-item" href="#">Alaska</a>
            <a class="dropdown-item" href="#">Arizona</a>
            <a class="dropdown-item" href="#">Arkansas</a>
            <a class="dropdown-item" href="#">California</a>
            <a class="dropdown-item" href="#">Colorado</a>
            <a class="dropdown-item" href="#">Connecticut</a>
            <a class="dropdown-item" href="#">Delaware</a>
            <a class="dropdown-item" href="#">Florida</a>
            <a class="dropdown-item" href="#">Georgia</a>
            <a class="dropdown-item" href="#">Hawaii</a>
            <a class="dropdown-item" href="#">Idaho</a>
            <a class="dropdown-item" href="#">Illinois</a>
            <a class="dropdown-item" href="#">Indiana</a>
            <a class="dropdown-item" href="#">Iowa</a>
            <a class="dropdown-item" href="#">Kansas</a>
            <a class="dropdown-item" href="#">Kentucky</a>
            <a class="dropdown-item" href="#">Louisiana</a>
            <a class="dropdown-item" href="#">Maine</a>
            <a class="dropdown-item" href="#">Maryland</a>
            <a class="dropdown-item" href="#">Massachusetts</a>
            <a class="dropdown-item" href="#">Michigan</a>
            <a class="dropdown-item" href="#">Minnesota</a>
            <a class="dropdown-item" href="#">Mississippi</a>
            <a class="dropdown-item" href="#">Missouri</a>
            <a class="dropdown-item" href="#">Montana</a>
            <a class="dropdown-item" href="#">Nebraska</a>
            <a class="dropdown-item" href="#">Nevada</a>
            <a class="dropdown-item" href="#">New Hampshire</a>
            <a class="dropdown-item" href="#">New Jersey</a>
            <a class="dropdown-item" href="#">New Mexico</a>
            <a class="dropdown-item" href="#">New York</a>
            <a class="dropdown-item" href="#">North Carolina</a>
            <a class="dropdown-item" href="#">North Dakota</a>
            <a class="dropdown-item" href="#">Ohio</a>
            <a class="dropdown-item" href="#">Oklahoma</a>
            <a class="dropdown-item" href="#">Oregon</a>
            <a class="dropdown-item" href="#">Pennsylvania</a>
            <a class="dropdown-item" href="#">Rhode Island</a>
            <a class="dropdown-item" href="#">South Carolina</a>
            <a class="dropdown-item" href="#">South Dakota</a>
            <a class="dropdown-item" href="#">Tennessee</a>
            <a class="dropdown-item" href="#">Texas</a>
            <a class="dropdown-item" href="#">Utah</a>
            <a class="dropdown-item" href="#">Vermont</a>
            <a class="dropdown-item" href="#">Virginia</a>
            <a class="dropdown-item" href="#">Washington</a>
            <a class="dropdown-item" href="#">West Virginia</a>
            <a class="dropdown-item" href="#">Wisconsin</a>
            <a class="dropdown-item" href="#">Wyoming</a>
        </div>
    </div>
    <div class="hide" id="coviddata" hidden>
        <span id="stateName">State Data</span><span class="caret"></span>
        <table id="table_body"></table>
    </div>
    <div class="row">
        <div class="col-2 box">
            Covid facts
        </div>
        <div class="col-3">

        </div>
        <div class="col-2 box">
            Covid facts
        </div>
        <div class="col-3">

        </div>
        <div class="col-2 box">
            Covid facts
        </div>
    </div>
    <div class="col-8">
        HI
        <canvas id="myChart" width="400" height="400"></canvas>
    </div>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <!-- <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-analytics.js"></script> -->
    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "AIzaSyALk44aihOM5EqeiQwfD_vhIF7YhXIVwMY",
            authDomain: "swamphackscovid19data.firebaseapp.com",
            databaseURL: "https://swamphackscovid19data-default-rtdb.firebaseio.com",
            projectId: "swamphackscovid19data",
            storageBucket: "swamphackscovid19data.appspot.com",
            messagingSenderId: "573451783241",
            appId: "1:573451783241:web:96c03f6350266800a98398",
            measurementId: "G-G0JKHK3W3V"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>
</div>
<script>
    var stateAbr = ["AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL",
        "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD",
        "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM",
        "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN",
        "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"];

    var stateName = ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida",
        "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland",
        "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico",
        "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee",
        "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"];

    var states = {};
    
    for (var i = 0; i < 50; i++) {
        states[stateName[i]] = stateAbr[i];
    }
    
    
    $('.dropdown-menu a').click(function () {
        $('#selected').text($(this).text());
        if ($(this).text() == "Choose State" && document.getElementById('coviddata').getAttribute("hidden") == null) {
            document.getElementById('coviddata').setAttribute("hidden", true);

        }
        else if ($(this).text() != "Choose State") {
            //Display Code below
            var state = states[$(this).text()]; //this should be interchangeable due to drop down
            console.log(state);
            var city = "Jacksonville";
            var zip = "32223";
            var database = firebase.database();
            var hospData = database.ref("hospital_data");
            var stateData = database.ref("state_data");
            //open snapshot
            dates = [];
            deaths = [];
            hospitalized = [];
            datesmin = [];
            deathsmin = [];
            hospitalizedmin = [];
            inc = 0;
            stateData.orderByChild("state").equalTo(state).once('value', function (snapshot) {
                var data = snapshot.val();
                for (let i in data) {
                    var dat = data[i].state;
                    if (inc < 8) {
                        datesmin.push(data[i].date);
                        deathsmin.push(data[i].death);
                        hospitalizedmin.push(data[i].hospitalizedCurrently)
                    }
                    dates.push(data[i].date);
                    deaths.push(data[i].death);
                    hospitalized.push(data[i].hospitalizedCurrently)
                    $("#table_body").append("<tr><td>" + dat + "</td></tr>"); //I added it to a table, but dat currently contains the state val and 
                    // data currently contains the whole chunk from date to deaths etc
                    inc++;
                }
            });

            console.log(deathsmin);
            var max = deathsmin.pop() + 1000;
            var min = hospitalizedmin.pop() - 1000;
            console.log(deathsmin[0]);
            new Chart(document.getElementById("myChart"), {
                type: 'line',
                data: {
                    labels: datesmin,
                    datasets: [{
                        data: deathsmin,
                        label: "X",
                        borderColor: "#8e5ea2",
                        fill: false
                    },
                    {
                        data: hospitalizedmin,
                        label: "Y",
                        borderColor: "#3cba9f",
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                suggestedMin: 0,
                                suggestedMax: 15000
                            }
                        }]
                    }
                }
            });
        }

    });

</script>

<style>
    .dropdown-menu {
        max-height: 200px;
        overflow-y: auto;
    }

    .dropdown-space {
        margin-bottom: 6cm;
    }

    .box {
        width: auto;
        padding: 10px;
        border: 5px solid gray;
        margin: 0;
    }
</style>